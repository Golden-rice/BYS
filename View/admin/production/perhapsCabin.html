<{extends file='layout.html'}>

<{block name="title"}>追位<{/block}>
<{block name="content"}>
<div class="panel panel-default">
  <div class="panel-body">
		<div class="form-horizontal">
			<div class="form-group">
				<div class="col-lg-10">
					
				<textarea name="" class="form-control" id="pnr" style="resize:none" rows="5" placeholder="SS:UA088/G/19MAY17/PEKEWR/NN1
SS:UA089/S/29MAY17/EWRPEK/NN1" ></textarea>
				</div>
				<div class="col-lg-2">
					<input type="button" id="dosubmit" class="btn btn-primary" value='提交'>
					<input type="button" id="test" class="btn" value="test">
				</div>
			</div>
		</div>
	</div>
</div>

<div id="content-progress"></div>
<div id="lab" style="display:none">
	<div class="panel panel-default">
	  <div class="panel-body">

		</div>
	</div>
</div>
<div id="content"></div>

<!-- 弹出框 -->
<div class="modal fade" id="makeModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" style='width:1200px'>
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                <!-- <h4 class="modal-title" id="myModalLabel">弹出框</h4> -->
            </div>
            <div class="modal-body">
            	<div id='modalContent'></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
            </div>
        </div>
    </div>
</div>
<!-- 弹出框 END -->


<script>
require(['eterm'],function(eterm){

var tpl = {
	cabinSeqTpl: cabinSeqTpl,
	ssCabinRoutTpl: ssCabinRoutTpl,
	getRoutAvhTpl: getRoutAvhTpl,
	mkRoutTpl: mkRoutTpl,
}

var setCommend = function(command){

$('#dosubmit').click(function(){
		command.pnr({
			pnr: $('#pnr').val()
		})
})

$('#test').click(function(){
		command.ssCabin({
			pnr: $('#pnr').attr("placeholder")
		})
})

}

setCommend(eterm.createCommand(eterm.eterm, tpl));

function cabinSeqTpl(array, dom, wrap, type){

		"use strict";

		let html = '', modal = "",
		appendType = type !== ""? type : 'w',
	  context = wrap !== "" ? wrap : document;


		html += `
		<div class="panel panel-default">
		  <div class="panel-body">
		  <h4>舱位序列</h4>
		  <p>
		`
		for(var i = 0; i < array.length; i++){
			html += array[i].seat+",";
		}
		
		html += ` </p>
			<button class="btn btn-primary"  data-toggle="modal" data-target="#makeModal">查看具体内容</button>
			</div>
		</div>
		`


		modal += `<table class="${dom} table-hover table-bordered table-responsive">
			<tr>
				<th>序号</th>
				<th>fare</th>
				<th>提前出票</th>
				<th>单程价格</th>
				<th>往返价格</th>
				<th>舱位</th>
				<th>最短停留</th>
				<th>最长停留</th>
				<th>适用截止日期</th>
				<th>可用星期</th>
				<th>出发</th>
				<th>到达</th>
			</tr>`
			for(let line =0; line< array['length']; line++){
			modal += `
				<tr class='line'>
					<td class='index' >${array[line]['index']}</td>
					<td class='fare'>${array[line]['fare']}</td>
					<td class='ADVPDay'>${array[line]['ADVPDay']}</td>
					<td class='singleLineFee'>${array[line]['singleLineFee']}</td>
					<td class='backLineFee'>${array[line]['backLineFee']}</td>
					<td class='seat'>${array[line]['seat']}</td>
					<td class='minStay'>${array[line]['minStay']}</td>
					<td class='maxStay'>${array[line]['maxStay']}</td>
					<td class='allowDate'>${array[line]['allowDateStart']} - ${array[line]['allowDateEnd']}</td>
					<td class='allowWeek'>${array[line]['allowWeek']}</td>
					<td class='start'>${array[line]['start']}</td>
					<td class='end'>${array[line]['end']}</td>
					</td>
				</tr>
				`
			}
			modal += `</table>`
	


	  if(appendType === 'w'){
			$(context).html(html);
			$("#modalContent").html(modal)
		}
		else if(appendType === 'a'){
			$(context).append(html);
			$("#modalContent").append(modal)
		}
}

function ssCabinRoutTpl(array, dom, wrap, type){

		"use strict";

		let html = '', 
		appendType = type !== ""? type : 'w',
	  context = wrap !== "" ? wrap : document;

	  console.log(array[1]);
	  html += `<table class="${dom} table-hover table-bordered table-responsive">
			<tr>
				<th>航班</th>
				<th>航空公司</th>
				<th>舱位</th>
				<th>日期</th>
				<th>出发</th>
				<th>到达</th>
			</tr>`
		for(var i = 0; i< array[0].length; i++){
			if(!array[0][i]){
				html += ` 
					<tr>
						<td>${array[1][i][1]}</td>
						<td>${array[1][i][2]}</td>
						<td>${array[1][i][3]}</td>
						<td>${array[1][i][4]}</td>
						<td>${array[1][i][5]}</td>
						<td>${array[1][i][6]}</td>
					</tr>
				`
			}else{
				html += ` 
					<tr>
						<td><span style="color:red">${array[1][i][1]}</span></td>
						<td><span style="color:red">${array[1][i][2]}</span></td>
						<td><span style="color:red">${array[1][i][3]}</span></td>
						<td><span style="color:red">${array[1][i][4]}</span></td>
						<td><span style="color:red">${array[1][i][5]}</span></td>
						<td><span style="color:red">${array[1][i][6]}</span></td>
					</tr>
				`			
			}

		}
		html += `</table>`

	  if(appendType === 'w'){
			$(context).html(html);
		}
		else if(appendType === 'a'){
			$(context).append(html);
		}
}

function mkRoutTpl(array, dom, wrap, type){
		"use strict";

		let html = '', 
		appendType = type !== ""? type : 'w',
	  context = wrap !== "" ? wrap : document;

	  html += `<table class="${dom} table-hover table-bordered table-responsive">
			<tr>
				<th>航空公司</th>
				<th>日期</th>
				<th>目标航段出发</th>
				<th>目标航段到达</th>
				<th>匹配舱位出发</th>
				<th>匹配舱位到达</th>
				<th>中转</th>
			</tr>
			<tr>
				<td>${array.airCompany}</td>
				<td>${array.startDate}</td>
				<td>${array.matchStart}</td>
				<td>${array.matchEnd}</td>
				<td>${array.start}</td>
				<td>${array.end}</td>
				<td>${array.other}</td>
			</tr>
			`

		if(appendType === 'w'){
			$(context).html(html);
		}
		else if(appendType === 'a'){
			$(context).append(html);
		}
}

function getRoutAvhTpl(array, dom, wrap, type){
		"use strict";

		let html = '', 
		appendType = type !== ""? type : 'w',
	  context = wrap !== "" ? wrap : document;

		if(array.routAvhResult.status){
			html += `<table class="${dom} table-hover table-bordered table-responsive">
				<tr>
					<th>序号</th>
					// <th>航空公司</th>
					<th>日期</th>
					<th>时间</th>
					<th>出发</th>
					<th>到达</th>
					<th>航班</th>
					<th>舱位</th>
					<th>舱位数</th>
				</tr>
				`
				for(let l in array.routAvhResult.routed){
					for(let name in array.routAvhResult.routed[l]){
					for (let i in array.routAvhResult.routed[l][name]){ // 所匹配出发到达的航程
						for (let part in array.routAvhResult.routed[l][name][i]){ // 航段

						html += `
							<tr>
								<td>${i}-${part}</td>
								// <td>${array.routAvhResult.routed[l][name][i][part].airCompany}</td>
								<td>${array.routAvhResult.routed[l][name][i][part].startDate}</td>
								<td>${array.routAvhResult.routed[l][name][i][part].startTime}-(${array.routAvhResult.routed[l][name][i][part].flightTime})-${array.routAvhResult.routed[l][name][i][part].endTime}</td>
								<td>${array.routAvhResult.routed[l][name][i][part].start}</td>
								<td>${array.routAvhResult.routed[l][name][i][part].end}</td>
								<td>${array.routAvhResult.routed[l][name][i][part].flight}</td>
								<td>${array.targetCabin}</td>
								<td>${array.routAvhResult.routed[l][name][i][part].cabin[array.targetCabin]}</td>
							</tr>
						`
						}
					
					}
					}
				}
		
		}

	  if(appendType === 'w'){
			$(context).html(html);
		}
		else if(appendType === 'a'){
			$(context).append(html);
		}

}


})
</script>
<{/block}>
